<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WOIC 2025 Badge Generator</title>

  <!-- Cropper.js -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.css" rel="stylesheet" />
  <style>
    :root {
      --bg: #14284b;
      --accent: #ffce00;
      --btn-font: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    body {
      margin: 0;
      font-family: var(--btn-font);
      background: var(--bg);
      color: #fff;
      text-align: center;
      padding: 24px;
    }
    h1 { margin: 0 0 10px; }
    canvas {
      width: min(90vw, 800px);
      height: auto;
      border: 2px solid var(--accent);
      border-radius: 16px;
      background: #000;
      margin-top: 20px;
    }
    .controls {
      margin-top: 16px;
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .btn {
      background: var(--accent);
      color: #111;
      font-family: var(--btn-font);
      font-weight: 700;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
      min-width: 160px;
      text-align: center;
    }
    .btn:hover { background: #e0b800; }
    input[type="file"] { display: none; }

    /* Crop modal */
    .modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,.7);
      display: none; align-items: center; justify-content: center;
      z-index: 9999;
    }
    .modal.open { display: flex; }
    .modal-card {
      background: #0f1f39;
      border-radius: 16px;
      width: min(92vw, 860px);
      height: min(90vh, 680px);
      display: flex; flex-direction: column;
      overflow: hidden;
    }
    .modal-body {
      flex: 1; display: flex; align-items: center; justify-content: center;
      position: relative; overflow: hidden;
    }
    #preview {
      max-width: 100%; max-height: 100%;
      display: block; background: #111;
      user-select: none; touch-action: none;
    }
    #frame-overlay {
      position: absolute; inset: 0;
      max-width: 100%; max-height: 100%;
      pointer-events: none;
    }
    .modal-footer {
      padding: 12px;
      display: flex; justify-content: center; gap: 12px;
      background: rgba(0,0,0,.25);
    }
  </style>
</head>
<body>
  <h1>WOIC 2025 Badge Generator</h1>
  <p>Upload and adjust your photo, then download your badge with the official frame.</p>

  <!-- Buttons -->
  <div class="controls">
    <label class="btn">
      <input id="file" type="file" accept="image/*" />
      Upload Photo
    </label>
    <button id="download" class="btn">Download Badge</button>
    <button id="reset" class="btn">Reset</button>
  </div>

  <!-- Final Badge -->
  <canvas id="canvas" width="800" height="800"></canvas>

  <!-- Cropping Modal -->
  <div id="modal" class="modal">
    <div class="modal-card">
      <div class="modal-body">
        <img id="preview" alt="Crop preview" />
        <img id="frame-overlay" alt="" />
      </div>
      <div class="modal-footer">
        <button id="cancel" class="btn">Cancel</button>
        <button id="confirm" class="btn">Confirm Crop</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.js"></script>
  <script>
    const fileInput = document.getElementById('file');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    const modal = document.getElementById('modal');
    const previewImg = document.getElementById('preview');
    const frameOverlay = document.getElementById('frame-overlay');
    const btnDownload = document.getElementById('download');
    const btnReset = document.getElementById('reset');
    const btnConfirm = document.getElementById('confirm');
    const btnCancel = document.getElementById('cancel');

    const frame = new Image();
    frame.src = 'woic-frame.png'; // must be in repo folder
    let cropper = null;

    frame.onload = () => {
      canvas.width = frame.naturalWidth;
      canvas.height = frame.naturalHeight;
      drawFrameOnly();
      frameOverlay.src = frame.src;
    };

    function drawFrameOnly() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(frame, 0, 0, canvas.width, canvas.height);
    }

    // File upload
    fileInput.addEventListener('change', e => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        previewImg.src = ev.target.result;
        modal.classList.add('open');
        document.body.style.overflow = 'hidden';
      };
      reader.readAsDataURL(file);
    });

    previewImg.addEventListener('load', () => {
      if (cropper) { cropper.destroy(); cropper = null; }
      cropper = new Cropper(previewImg, {
        aspectRatio: 1,
        viewMode: 1,
        guides: false,
        center: false,
        background: false,
        highlight: false,
        autoCrop: true,
        autoCropArea: 1,
        dragMode: 'move',
        cropBoxMovable: false,
        cropBoxResizable: false,
        toggleDragModeOnDblclick: false,
        zoomOnWheel: true
      });
    });

    // Confirm crop
    btnConfirm.addEventListener('click', () => {
      if (!cropper) return;
      const cropped = cropper.getCroppedCanvas({
        width: canvas.width,
        height: canvas.height
      });
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(cropped, 0, 0, canvas.width, canvas.height);
      ctx.drawImage(frame, 0, 0, canvas.width, canvas.height);
      closeModal();
    });

    btnCancel.addEventListener('click', closeModal);

    function closeModal() {
      if (cropper) { cropper.destroy(); cropper = null; }
      modal.classList.remove('open');
      document.body.style.overflow = '';
      previewImg.src = '';
    }

    // Download
    btnDownload.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'WOIC2025_Badge.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });

    // Reset
    btnReset.addEventListener('click', () => {
      fileInput.value = '';
      drawFrameOnly();
    });
  </script>
</body>
</html>


